{"version":3,"sources":["base.js"],"names":["buildGrid","distanceTo","Vector2","sounds","computePath","Character","constructor","x","y","attack","swish0","swish1","swish2","swish3","footstep","foot0","foot1","foot2","foot3","foot4","ouch","hit0","hit1","hit2","idle","walk","damage","death","pos","setTeam","team","game","maxhealth","hp","setRenderer","renderer","Math","floor","random","maxDamage","minDamage","whoAmI","console","log","name","movedThisRound","debugStr","selected","receiveDamage","damageResist","audio","length","currentTime","play","model","playAnimation","animations","targetCharacter","attacksLeft","attackCount","hitDelay","i","setTimeout","face","moveSprite","vec","copy","update","canReach","square","ourPos","distance","movement","path","canReachAttack","attackRange","influenceGrid","g","touchCell","influence","max","min","influenceDiag","influencePos","getOpposingTeam"],"mappings":"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","sourcesContent":["import { buildGrid, distanceTo } from \"../gridutils\"\nimport { Vector2 } from \"three\"\nimport * as sounds from \"../../client/sounds\"\nimport { computePath } from \"../astar\"\n\nexport default class Character {\n  name = \"Basic Character\"\n  shortCode = \"??\"\n  modelName = \"Skeleton.glb\"\n  hp = 5000\n  movement = 5\n  attackRange = 5\n  attackCount = 1\n  attackName = \"Splash\"\n  sounds = {\n    attack: [sounds.swish0, sounds.swish1, sounds.swish2, sounds.swish3],\n    footstep: [sounds.foot0, sounds.foot1, sounds.foot2, sounds.foot3, sounds.foot4],\n    ouch: [sounds.hit0, sounds.hit1, sounds.hit2],\n  }\n\n  animations = {\n    idle: \"Idle\",\n    walk: \"Walk\",\n    damage: \"RecieveHit\",\n    attack: \"Attack\",\n    death: \"Death\",\n  }\n\n  minDamage = 1000\n  maxDamage = 3000\n  damageResist = -0.3\n  initiative = 2\n  points = 0\n  influencePos = 0\n  influenceDiag = 0\n  characterSelected = false\n  actionPoints = 2\n  movedThisRound = false\n  attackedThisRound = false\n  renderer = null\n  attacksLeft = 0\n\n  constructor(x, y) {\n    this.x = x\n    this.y = y\n    this.pos = new Vector2(x, y)\n  }\n\n  setTeam(team) {\n    this.team = team\n    this.game = team.game\n    this.maxhealth = this.hp\n  }\n\n  setRenderer(renderer) {\n    this.renderer = renderer\n  }\n\n  damage() {\n    return Math.floor(Math.random() * this.maxDamage + this.minDamage)\n  }\n\n  whoAmI() {\n    console.log(\n      this.name,\n      this.x,\n      this.y,\n      this.hp,\n      this.movedThisRound\n      // this.active,\n      // this.turn\n    )\n  }\n\n  debugStr() {\n    return this.constructor.name + \": \" + this.hp + \" hp \" + this.x + \",\" + this.y\n  }\n\n  selected() {\n    console.log(whoAmI)\n  }\n\n  receiveDamage(damage) {\n    this.hp -= damage - damage * this.damageResist\n    let audio = this.sounds.ouch\n    if (audio.length) {\n      audio = audio[Math.floor(Math.random() * audio.length)]\n    }\n    audio.currentTime = 0\n    audio.play()\n\n    if (this.model) {\n      this.model.playAnimation(this.animations.damage, true, false)\n    }\n  }\n\n  attack(targetCharacter) {\n    this.attacksLeft = this.attackCount\n    const hitDelay = 500\n    for (let i = 0; i < this.attackCount ?? 1; i++) {\n      setTimeout(() => {\n        if (targetCharacter.hp < 0) {\n          this.attacksLeft = 0\n          return\n        }\n\n        setTimeout(() => {\n          targetCharacter.receiveDamage(this.damage())\n          setTimeout(() => {\n            this.attacksLeft--\n          }, hitDelay)\n        }, hitDelay)\n\n        let audio = this.sounds.attack\n        if (audio.length) {\n          audio = audio[Math.floor(Math.random() * audio.length)]\n        }\n        audio.play()\n\n        if (this.model) {\n          this.model.face(targetCharacter.pos)\n          this.model.playAnimation(this.animations.attack, true, false)\n        }\n      }, 1.5 * 1000 * i + i * hitDelay)\n    }\n  }\n\n  moveSprite(vec) {\n    //vec\n    this.y = vec.y //vec.y\n    this.x = vec.x //vec.x\n    this.pos.copy(vec)\n    this.game.update()\n  }\n\n  canReach(square) {\n    const ourPos = { y: this.y, x: this.x }\n    //is distanceTo <= this.character.movement\n    let distance = distanceTo(square, ourPos)\n    if (distance <= this.movement) {\n      const path = computePath(ourPos, square)\n      if (path.length > 0 && path.length <= this.movement) {\n        return true\n      }\n    }\n\n    return false\n  }\n\n  canReachAttack(square) {\n    let distance = distanceTo(square, this.pos)\n    if (distance <= this.attackRange) {\n      return true\n    } else {\n      return false\n    }\n  }\n\n  influenceGrid(g) {\n    const touchCell = (x, y, influence) => {\n      if (x < 0 || y < 0 || x >= g.length || y >= g.length) {\n        // Outside of grid bounds\n        return\n      }\n\n      if (g[y][x] <= 0) {\n        // Non-Walkable OR has enemy on it\n        return\n      }\n\n      if (g[y][x] > 1) {\n        // Something else already influenced it, lower it to indicate danger\n        g[y][x] = Math.max(g[y][x], influence) - Math.min(g[y][x], influence)\n      } else if (g[y][x] < 1) {\n        // Cell has already been yoinked too many times, let it stay negative\n        g[y][x] = g[y][x] - influence\n      } else {\n        // Cell is at its default value, give it our influence\n        g[y][x] = influence\n      }\n    }\n\n    const x = this.x,\n      y = this.y\n\n    // Top row\n    touchCell(x - 1, y - 1, this.influenceDiag)\n    touchCell(x, y - 1, this.influencePos)\n    touchCell(x + 1, y - 1, this.influenceDiag)\n\n    // Our Row\n    touchCell(x - 1, y, this.influencePos)\n    g[y][x] = 0 // Set the cell we're standing on to 0\n    touchCell(x + 1, y, this.influencePos)\n\n    // Top row\n    touchCell(x - 1, y + 1, this.influenceDiag)\n    touchCell(x, y + 1, this.influencePos)\n    touchCell(x + 1, y + 1, this.influenceDiag)\n  }\n\n  getOpposingTeam() {\n    return this.team.getOpposingTeam()\n  }\n}\n"]}